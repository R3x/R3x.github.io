<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Advanced GDB Debugging | Siddharth's Blog</title><meta name=keywords content="Debugging,GDB"><meta name=description content="Advanced GDB Debugging In this post, I would like to point out some tips/tricks to make debugging easier with GDB. I will be focusing on Linux x86_64 binaries, but most of the things should work on other architectures as well. I will try to cover both
I am gonna assume basic familiarity with GDB, such as setting breakpoints/stepping through code, etc. If you are not familiar with GDB, I would recommend reading/watching some basic tutorial for GDB."><meta name=author content="Siddharth Muralee"><link rel=canonical href=https://R3x.github.io/posts/gdb_advanced/><meta name=google-site-verification content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=/home_icon.jpeg as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://R3x.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://R3x.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://R3x.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://R3x.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://R3x.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Advanced GDB Debugging"><meta property="og:description" content="Advanced GDB Debugging In this post, I would like to point out some tips/tricks to make debugging easier with GDB. I will be focusing on Linux x86_64 binaries, but most of the things should work on other architectures as well. I will try to cover both
I am gonna assume basic familiarity with GDB, such as setting breakpoints/stepping through code, etc. If you are not familiar with GDB, I would recommend reading/watching some basic tutorial for GDB."><meta property="og:type" content="article"><meta property="og:url" content="https://R3x.github.io/posts/gdb_advanced/"><meta property="og:image" content="https://R3x.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-25T23:43:10+00:00"><meta property="article:modified_time" content="2022-10-25T23:43:10+00:00"><meta property="og:site_name" content="Siddharth's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://R3x.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Advanced GDB Debugging"><meta name=twitter:description content="Advanced GDB Debugging In this post, I would like to point out some tips/tricks to make debugging easier with GDB. I will be focusing on Linux x86_64 binaries, but most of the things should work on other architectures as well. I will try to cover both
I am gonna assume basic familiarity with GDB, such as setting breakpoints/stepping through code, etc. If you are not familiar with GDB, I would recommend reading/watching some basic tutorial for GDB."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://R3x.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Advanced GDB Debugging","item":"https://R3x.github.io/posts/gdb_advanced/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Advanced GDB Debugging","name":"Advanced GDB Debugging","description":"Advanced GDB Debugging In this post, I would like to point out some tips/tricks to make debugging easier with GDB. I will be focusing on Linux x86_64 binaries, but most of the things should work on other architectures as well. I will try to cover both\nI am gonna assume basic familiarity with GDB, such as setting breakpoints/stepping through code, etc. If you are not familiar with GDB, I would recommend reading/watching some basic tutorial for GDB.","keywords":["Debugging","GDB"],"articleBody":"Advanced GDB Debugging In this post, I would like to point out some tips/tricks to make debugging easier with GDB. I will be focusing on Linux x86_64 binaries, but most of the things should work on other architectures as well. I will try to cover both\nI am gonna assume basic familiarity with GDB, such as setting breakpoints/stepping through code, etc. If you are not familiar with GDB, I would recommend reading/watching some basic tutorial for GDB.\nUsing the .gdbinit file Gdb uses a file called the .gdbinit file which is used to store all the settings needed when you start gdb. This can be configured on both a systemwide basis and also on a projectwide basis. The root .gdbinit is usually found in the /home directory, and the project specific .gdbinit is usually found in the root of the project directory.\nHowever to load a project specific .gdbinit file when you start gdb, you need to pass the following command to gdb:\ngdb -x GDB Advanced Commands GDB has a lot of commands, I plan to try and cover the commands that helped me the most while debugging applications. A good starting tip - is that whenever you are stuck or can’t remember the command that you were looking for, try using the apropos command. This is basically a regex search through the commands list and you can usually find the command you were looking for. To get more information about a command, use the help command.\nWatchpoints Watchpoints are used to stop exectuing the program when a certain memory location is read/written. This is useful when you want to know when a certain variable is accessed. But you don’t want to set a breakpoint on every single line where the variable may be accessed.\n(gdb) watch __afl_prev_loc Note: watchpoints can be called on any memory address, but you need to cast the address to help determine how many bytes need to be watched. For example, if you want to watch a 4 byte integer, you need to cast the address to (int *)\n(gdb) watch *(int *)0x7fffffffe3e0 You need to use the * to dereference the address else gdb will try to watch the constant address itself.\nwatch - watchpoint for write access rwatch - watchpoint for read access awatch - watchpoint for read/write access Conditional Breakpoints and Watchpoints Conditional breakpoints are a amazing feature of GDB, which allows you to set a breakpoint only if a certain condition is met. This is very useful when you are debugging a basic block that’s called multiple times, and you want to stop only when a certain condition is met.\nFor ex, if I want to stop at the call to __afl_maybe_log only if the the value of rcx is 0xdaef, I can use the following command:\n(gdb) break __afl_maybe_log if $rcx == 0xdaef If symbols are available, you can also have checks on condition on the values of variables. For ex, if I want to stop at the call to __afl_maybe_log only if the the value of __afl_prev_loc is 0xdaef, I can use the following command:\n(gdb) break __afl_maybe_log if __afl_prev_loc == 0xdaef Note: Sometimes if the type of the variable is not known you might have to cast it to the correct type, also useful if you are checking the value of a memory address for ex:\n(gdb) break __afl_maybe_log if (unsigned long)__afl_prev_loc == 0xdaef (gdb) break __afl_maybe_log if *(int *)($rbp - 0x10) == 0xdaef (gdb) break __afl_maybe_log if *(int *)0x7fffffffe0a0 == 0xdaef if the breakpoint is already set, you can add a condition to it using the condition command:\n(gdb) condition 1 $rcx == 0xdaef and you can remove the condition using the command :\n(gdb) condition 1 which resets the condition of the breakpoint.\nYou can also choose to ignore the breakpoint a certain number of times by using the ignore command:\n(gdb) ignore 1 5 which will not stop at the breakpoint for the next 5 times, and then start stopping at the breakpoint again.\nCatchpoints Another useful feature, especially when debugging multithreaded C++ applications is the catch command. It allows you to break the execution when a certain event occurs.\nFor ex, if I want to break when a thread is created, I can use the following command:\n(gdb) catch thread create Some common uses are :\ncatch syscall : Break when a syscall is made catch syscall : Break when a specific syscall is made catch throw : Break when a specific exception is thrown (C++) catch catch : Break when a specific exception is caught (C++) catch signal : Break when a specific signal is sent catch load/unload : Break when a library is loaded/unloaded Custom commands TODO: Briefly explain how to write custom commands\nGDB Python Scripting GDB has a python scripting interface, which I have found to be useful exclusively for CTFs. I will try to quickly go over it, so that people can try it out for themselves.\nRunning a python script with gdb is as simple as running the following command:\ngdb -x if you want to run a python script on a running gdb instance, you can use the source command:\n(gdb) source Defining custom commands in GDB GDB allows you to define custom commands, in python. This is very useful to run a bunch of commands together and add some custom logic to it.\nimport gdb class TestCommand(gdb.Command): def __init__(self): super(TestCommand, self).__init__(\"test\", gdb.COMMAND_USER) def invoke(self, arg, from_tty): print(\"Test command invoked\") counter = 0 try: total_count = int(arg.split(\" \")[0]) skip_count = int(arg.split(\" \")[1]) except: print(\"Invalid arguments passed\") return print(f\"Total count: {total_count}\") print(f\"Skip count: {skip_count}\") while counter \u003c total_count: if counter % skip_count == 0: # Skip every skip count iteration gdb.execute(\"continue\") continue gdb.execute(\"info registers\") counter += 1 gdb.execute(\"continue\") TestCommand() The above script defines a custom command called test which takes 2 arguments - total_count and skip_count. The command will print the register values for every iteration, except for every skip_count iteration.\nDefining custom pretty printers Say you have a struct defined as follows:\nstruct Node { int value; struct Node *next; }; While debugging, the program you wish to print the structure of the linked list. You can define a custom pretty printer to do that.\nTODO CTF challenge solving I have used GDB python scripting to solve a few CTF challenges. It’s a quick way to get some information from the binary, if you need to extract some runtime information.\nFor ex, here I am extracting characters which are generated during runtime, so that I can use them to reverse the encryption algorithm.\nTODO GDB Plugins There are a lot of extensions available for GDB, which can make your life easier.\nGEF GEF is a GDB extension which adds a lot of useful features to GDB. It’s a must have for CTFs. I will try to do another blog post on features specific to GEF that can be really helpful for CTFs.\nDecomp2dbg This is a plugin which allows you to connect GDB to a decompiler. It’s shows you the decompiled code in GDB, and allows you to set breakpoints in the decompiled code. It’s extremely useful when you are debugging a binary without source code, and allows you to keep in sync with the decompiled code for faster debugging or reverse engineering.\n","wordCount":"1229","inLanguage":"en","datePublished":"2022-10-25T23:43:10Z","dateModified":"2022-10-25T23:43:10Z","author":{"@type":"Person","name":"Siddharth Muralee"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://R3x.github.io/posts/gdb_advanced/"},"publisher":{"@type":"Organization","name":"Siddharth's Blog","logo":{"@type":"ImageObject","url":"https://R3x.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://R3x.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://R3x.github.io/home_icon.jpeg alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://R3x.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://R3x.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://R3x.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://R3x.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://R3x.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://R3x.github.io/posts/>Posts</a></div><h1 class=post-title>Advanced GDB Debugging</h1><div class=post-meta><span title='2022-10-25 23:43:10 +0000 UTC'>October 25, 2022</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Siddharth Muralee&nbsp;|&nbsp;<a href=https://github.com/R3x/R3x.github.io/tree/master/content/posts/gdb_advanced.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#advanced-gdb-debugging aria-label="Advanced GDB Debugging">Advanced GDB Debugging</a><ul><li><a href=#using-the-gdbinit-file aria-label="Using the .gdbinit file">Using the .gdbinit file</a></li><li><a href=#gdb-advanced-commands aria-label="GDB Advanced Commands">GDB Advanced Commands</a><ul><li><a href=#watchpoints aria-label=Watchpoints>Watchpoints</a></li><li><a href=#conditional-breakpoints-and-watchpoints aria-label="Conditional Breakpoints and Watchpoints">Conditional Breakpoints and Watchpoints</a></li><li><a href=#catchpoints aria-label=Catchpoints>Catchpoints</a></li><li><a href=#custom-commands aria-label="Custom commands">Custom commands</a></li></ul></li><li><a href=#gdb-python-scripting aria-label="GDB Python Scripting">GDB Python Scripting</a><ul><li><a href=#defining-custom-commands-in-gdb aria-label="Defining custom commands in GDB">Defining custom commands in GDB</a></li><li><a href=#defining-custom-pretty-printers aria-label="Defining custom pretty printers">Defining custom pretty printers</a></li><li><a href=#ctf-challenge-solving aria-label="CTF challenge solving">CTF challenge solving</a></li></ul></li><li><a href=#gdb-plugins aria-label="GDB Plugins">GDB Plugins</a><ul><li><a href=#gef aria-label=GEF>GEF</a></li><li><a href=#decomp2dbg aria-label=Decomp2dbg>Decomp2dbg</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h1 id=advanced-gdb-debugging>Advanced GDB Debugging<a hidden class=anchor aria-hidden=true href=#advanced-gdb-debugging>#</a></h1><p>In this post, I would like to point out some tips/tricks to make debugging easier with GDB. I will be focusing on Linux x86_64 binaries, but most of the things should work on other architectures as well. I will try to cover both</p><p>I am gonna assume basic familiarity with GDB, such as setting breakpoints/stepping through code, etc. If you are not familiar with GDB, I would recommend reading/watching some basic tutorial for GDB.</p><h2 id=using-the-gdbinit-file>Using the .gdbinit file<a hidden class=anchor aria-hidden=true href=#using-the-gdbinit-file>#</a></h2><p>Gdb uses a file called the <code>.gdbinit</code> file which is used to store all the settings needed when you start gdb. This can be configured on both a systemwide basis and also on a projectwide basis. The root <code>.gdbinit</code> is usually found in the <code>/home</code> directory, and the project specific <code>.gdbinit</code> is usually found in the root of the project directory.</p><p>However to load a project specific .gdbinit file when you start gdb, you need to pass the following command to gdb:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gdb -x &lt;path to .gdbinit file&gt;
</span></span></code></pre></div><h2 id=gdb-advanced-commands>GDB Advanced Commands<a hidden class=anchor aria-hidden=true href=#gdb-advanced-commands>#</a></h2><p>GDB has a lot of commands, I plan to try and cover the commands that helped me the most while debugging applications. A good starting tip - is that whenever you are stuck or can&rsquo;t remember the command that you were looking for, try using the <code>apropos</code> command. This is basically a regex search through the commands list and you can usually find the command you were looking for. To get more information about a command, use the <code>help</code> command.</p><h3 id=watchpoints>Watchpoints<a hidden class=anchor aria-hidden=true href=#watchpoints>#</a></h3><p>Watchpoints are used to stop exectuing the program when a certain memory location is read/written. This is useful when you want to know when a certain variable is accessed. But you don&rsquo;t want to set a breakpoint on every single line where the variable may be accessed.</p><pre tabindex=0><code class=language-gdb data-lang=gdb>(gdb) watch __afl_prev_loc
</code></pre><blockquote><p>Note: watchpoints can be called on any memory address, but you need to cast the address to help determine how many bytes need to be watched. For example, if you want to watch a 4 byte integer, you need to cast the address to <code>(int *)</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> watch *<span style=color:#f92672>(</span>int *<span style=color:#f92672>)</span>0x7fffffffe3e0
</span></span></code></pre></div><p>You need to use the <code>*</code> to dereference the address else gdb will try to watch the constant address itself.</p></blockquote><ul><li><code>watch</code> - watchpoint for write access</li><li><code>rwatch</code> - watchpoint for read access</li><li><code>awatch</code> - watchpoint for read/write access</li></ul><h3 id=conditional-breakpoints-and-watchpoints>Conditional Breakpoints and Watchpoints<a hidden class=anchor aria-hidden=true href=#conditional-breakpoints-and-watchpoints>#</a></h3><p>Conditional breakpoints are a amazing feature of GDB, which allows you to set a breakpoint only if a certain condition is met. This is very useful when you are debugging a basic block that&rsquo;s called multiple times, and you want to stop only when a certain condition is met.</p><p>For ex, if I want to stop at the call to __afl_maybe_log only if the the value of rcx is 0xdaef, I can use the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> break __afl_maybe_log <span style=color:#66d9ef>if</span> $rcx <span style=color:#f92672>==</span> 0xdaef
</span></span></code></pre></div><p>If symbols are available, you can also have checks on condition on the values of variables. For ex, if I want to stop at the call to __afl_maybe_log only if the the value of __afl_prev_loc is 0xdaef, I can use the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> break __afl_maybe_log <span style=color:#66d9ef>if</span> __afl_prev_loc <span style=color:#f92672>==</span> 0xdaef
</span></span></code></pre></div><blockquote><p>Note: Sometimes if the type of the variable is not known you might have to cast it to the correct type, also useful if you are checking the value of a memory address for ex:</p><pre tabindex=0><code class=language-gdb data-lang=gdb>(gdb) break __afl_maybe_log if (unsigned long)__afl_prev_loc == 0xdaef
(gdb) break __afl_maybe_log if *(int *)($rbp - 0x10) == 0xdaef
(gdb) break __afl_maybe_log if *(int *)0x7fffffffe0a0 == 0xdaef
</code></pre></blockquote><p>if the breakpoint is already set, you can add a condition to it using the <code>condition</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> condition <span style=color:#ae81ff>1</span> $rcx <span style=color:#f92672>==</span> 0xdaef
</span></span></code></pre></div><p>and you can remove the condition using the command :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> condition <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>which resets the condition of the breakpoint.</p><p>You can also choose to ignore the breakpoint a certain number of times by using the <code>ignore</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> ignore <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>5</span>
</span></span></code></pre></div><p>which will not stop at the breakpoint for the next 5 times, and then start stopping at the breakpoint again.</p><h3 id=catchpoints>Catchpoints<a hidden class=anchor aria-hidden=true href=#catchpoints>#</a></h3><p>Another useful feature, especially when debugging multithreaded C++ applications is the <code>catch</code> command. It allows you to break the execution when a certain event occurs.</p><p>For ex, if I want to break when a thread is created, I can use the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> catch thread create
</span></span></code></pre></div><p>Some common uses are :</p><ul><li><code>catch syscall</code> : Break when a syscall is made</li><li><code>catch syscall &lt;number/name></code> : Break when a specific syscall is made</li><li><code>catch throw &lt;regex></code> : Break when a specific exception is thrown (C++)</li><li><code>catch catch &lt;regex></code> : Break when a specific exception is caught (C++)</li><li><code>catch signal &lt;number/name></code> : Break when a specific signal is sent</li><li><code>catch load/unload &lt;regex></code> : Break when a library is loaded/unloaded</li></ul><h3 id=custom-commands>Custom commands<a hidden class=anchor aria-hidden=true href=#custom-commands>#</a></h3><p>TODO: Briefly explain how to write custom commands</p><h2 id=gdb-python-scripting>GDB Python Scripting<a hidden class=anchor aria-hidden=true href=#gdb-python-scripting>#</a></h2><p>GDB has a python scripting interface, which I have found to be useful exclusively for CTFs. I will try to quickly go over it, so that people can try it out for themselves.</p><p>Running a python script with gdb is as simple as running the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gdb &lt;target/executable&gt; -x &lt;path/to/script.py&gt;
</span></span></code></pre></div><p>if you want to run a python script on a running gdb instance, you can use the <code>source</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> source &lt;path/to/script.py&gt;
</span></span></code></pre></div><h3 id=defining-custom-commands-in-gdb>Defining custom commands in GDB<a hidden class=anchor aria-hidden=true href=#defining-custom-commands-in-gdb>#</a></h3><p>GDB allows you to define custom commands, in python. This is very useful to run a bunch of commands together and add some custom logic to it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> gdb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestCommand</span>(gdb<span style=color:#f92672>.</span>Command):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self):
</span></span><span style=display:flex><span>        super(TestCommand, self)<span style=color:#f92672>.</span>__init__(<span style=color:#e6db74>&#34;test&#34;</span>, gdb<span style=color:#f92672>.</span>COMMAND_USER)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>invoke</span>(self, arg, from_tty):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Test command invoked&#34;</span>)
</span></span><span style=display:flex><span>        counter <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            total_count <span style=color:#f92672>=</span> int(arg<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; &#34;</span>)[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>            skip_count <span style=color:#f92672>=</span> int(arg<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; &#34;</span>)[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Invalid arguments passed&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Total count: </span><span style=color:#e6db74>{</span>total_count<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Skip count: </span><span style=color:#e6db74>{</span>skip_count<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> counter <span style=color:#f92672>&lt;</span> total_count:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> counter <span style=color:#f92672>%</span> skip_count <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                <span style=color:#75715e># Skip every skip count iteration</span>
</span></span><span style=display:flex><span>                gdb<span style=color:#f92672>.</span>execute(<span style=color:#e6db74>&#34;continue&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            gdb<span style=color:#f92672>.</span>execute(<span style=color:#e6db74>&#34;info registers&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            counter <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            gdb<span style=color:#f92672>.</span>execute(<span style=color:#e6db74>&#34;continue&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TestCommand()
</span></span></code></pre></div><p>The above script defines a custom command called <code>test</code> which takes 2 arguments - <code>total_count</code> and <code>skip_count</code>. The command will print the register values for every iteration, except for every <code>skip_count</code> iteration.</p><h3 id=defining-custom-pretty-printers>Defining custom pretty printers<a hidden class=anchor aria-hidden=true href=#defining-custom-pretty-printers>#</a></h3><p>Say you have a struct defined as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>struct</span> Node {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> value;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> Node <span style=color:#f92672>*</span>next;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>While debugging, the program you wish to print the structure of the linked list. You can define a custom pretty printer to do that.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>TODO
</span></span></code></pre></div><h3 id=ctf-challenge-solving>CTF challenge solving<a hidden class=anchor aria-hidden=true href=#ctf-challenge-solving>#</a></h3><p>I have used GDB python scripting to solve a few CTF challenges. It&rsquo;s a quick way to get some information from the binary, if you need to extract some runtime information.</p><p>For ex, here I am extracting characters which are generated during runtime, so that I can use them to reverse the encryption algorithm.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>TODO
</span></span></code></pre></div><h2 id=gdb-plugins>GDB Plugins<a hidden class=anchor aria-hidden=true href=#gdb-plugins>#</a></h2><p>There are a lot of extensions available for GDB, which can make your life easier.</p><h3 id=gef>GEF<a hidden class=anchor aria-hidden=true href=#gef>#</a></h3><p>GEF is a GDB extension which adds a lot of useful features to GDB. It&rsquo;s a must have for CTFs. I will try to do another blog post on features specific to GEF that can be really helpful for CTFs.</p><h3 id=decomp2dbg>Decomp2dbg<a hidden class=anchor aria-hidden=true href=#decomp2dbg>#</a></h3><p>This is a plugin which allows you to connect GDB to a decompiler. It&rsquo;s shows you the decompiled code in GDB, and allows you to set breakpoints in the decompiled code. It&rsquo;s extremely useful when you are debugging a binary without source code, and allows you to keep in sync with the decompiled code for faster debugging or reverse engineering.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://R3x.github.io/tags/debugging/>Debugging</a></li><li><a href=https://R3x.github.io/tags/gdb/>GDB</a></li></ul><nav class=paginav><a class=prev href=https://R3x.github.io/posts/llvm_ir_tips/><span class=title>« Prev Page</span><br><span>LLVM Tips/Tricks</span></a>
<a class=next href=https://R3x.github.io/posts/llvm_debug/><span class=title>Next Page »</span><br><span>Debugging LLVM (opt) passes with VSCode</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Advanced GDB Debugging on twitter" href="https://twitter.com/intent/tweet/?text=Advanced%20GDB%20Debugging&amp;url=https%3a%2f%2fR3x.github.io%2fposts%2fgdb_advanced%2f&amp;hashtags=Debugging%2cGDB"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Advanced GDB Debugging on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fR3x.github.io%2fposts%2fgdb_advanced%2f&amp;title=Advanced%20GDB%20Debugging&amp;summary=Advanced%20GDB%20Debugging&amp;source=https%3a%2f%2fR3x.github.io%2fposts%2fgdb_advanced%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Advanced GDB Debugging on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fR3x.github.io%2fposts%2fgdb_advanced%2f&title=Advanced%20GDB%20Debugging"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Advanced GDB Debugging on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fR3x.github.io%2fposts%2fgdb_advanced%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Advanced GDB Debugging on whatsapp" href="https://api.whatsapp.com/send?text=Advanced%20GDB%20Debugging%20-%20https%3a%2f%2fR3x.github.io%2fposts%2fgdb_advanced%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Advanced GDB Debugging on telegram" href="https://telegram.me/share/url?text=Advanced%20GDB%20Debugging&amp;url=https%3a%2f%2fR3x.github.io%2fposts%2fgdb_advanced%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://R3x.github.io/>Siddharth's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>